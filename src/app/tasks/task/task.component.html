<mat-card
  class="item"
  *ngIf="task"
  [style.background-color]="task.backgroundColor"
  [style.color]="textColor"
>
  <div class="heading-info" (click)="editTask()">
    <div class="top-section">
      <p class="title">{{ task.title }}</p>

      <div
        class="status"
        [ngClass]="{
          'status-selected': task.status || isStatusIconSelected
        }"
        matTooltip="Set status"
      >
        <span
          [matMenuTriggerFor]="statusMenu"
          [style.background-color]="selectStatusBackgroundColor"
          [style.color]="selectStatusColor"
          (click)="statusIconClicked()"
          class="status-icon"
        >
          {{ task.status ? task.status : "ToDo" }}
        </span>
        <mat-menu #statusMenu="matMenu" (closed)="statusMenuClosed()">
          <div
            mat-menu-item
            class="menu-opts"
            (click)="onStatusChange(status.id)"
            [style.background-color]="status.backgroundColor"
            [style.color]="status.color"
            *ngFor="let status of statusOptions"
          >
            <span>{{ status.name }}</span>
          </div>
        </mat-menu>
      </div>
    </div>

    <div *ngIf="!showLabelText">
      <mat-chip-list>
        <div *ngFor="let label of labels">
          <span *ngFor="let taskId of label.taskIds">
            <mat-chip
              *ngIf="taskId == task.id"
              [style.background-color]="label.color"
              class="single-label my-chip"
              (click)="hideLabelName()"
            >
              {{ label.name }}
            </mat-chip>
          </span>
        </div>
      </mat-chip-list>
    </div>

    <div *ngIf="showLabelText">
      <mat-chip-list>
        <div *ngFor="let label of labels">
          <span *ngFor="let taskId of label.taskIds">
            <mat-chip
              *ngIf="taskId == task.id"
              [style.background-color]="label.color"
              class="chip-no-text"
              (click)="hideLabelName()"
            >
            </mat-chip>
          </span>
        </div>
      </mat-chip-list>
    </div>
    <p class="desc">
      {{ task.description }}
    </p>
  </div>

  <div class="actions-info">
    <p
      *ngIf="task.dueDate"
      matTooltip="task complete date"
      class="action-schedule"
      [ngClass]="{
        'due-date': overDue == false && task.dueDate.completed == false,
        'due-overdue': overDue == true,
        'due-complete': task.dueDate.completed == true
      }"
    >
      <mat-icon class="task-icon">schedule</mat-icon>
      <span class="info-text">{{
        task.dueDate.date | dateformat: "short"
      }}</span>
    </p>
    <p *ngIf="task.checklists && checklistsLength > 0" class="checklist-data">
      <mat-icon matBadgeColor="accent" class="material-icons-outlined task-icon"
        >check_box</mat-icon
      ><span class="checklist-text"
        >{{ checklistsCompletedLength }}/{{ checklistsLength }}</span
      >
      <span class="cdk-visually-hidden">
        Example with a home icon with overlaid badge showing the number 15
      </span>
    </p>
    <p *ngIf="task.message">
      <mat-icon
        class="material-icons-outlined task-icon"
        matTooltip="{{ task.message }}"
        >message</mat-icon
      >
    </p>

    <p class="priority-sec">
      <img
        class="opts images icon"
        [ngClass]="{
          'priority-selected': task.priority || isPriorityIconSelected
        }"
        src="./assets/images/priority/{{ priority }}.svg"
        (click)="setTaskPriority()"
        [matMenuTriggerFor]="menu"
        matTooltip="{{ priority }}"
      />
      <mat-menu #menu="matMenu" (closed)="priorityMenuClosed()">
        <div mat-menu-item class="menu-opts" (click)="selectedMenu('blocker')">
          <img class="images" src="./assets/images/priority/blocker.svg" />
          <span>Blocker</span>
        </div>
        <div mat-menu-item class="menu-opts" (click)="selectedMenu('critical')">
          <img class="images" src="./assets/images/priority/critical.svg" />
          <span>Critical</span>
        </div>
        <div mat-menu-item class="menu-opts" (click)="selectedMenu('major')">
          <img class="images" src="./assets/images/priority/major.svg" />
          <span>Major</span>
        </div>
        <div mat-menu-item class="menu-opts" (click)="selectedMenu('minor')">
          <img class="images" src="./assets/images/priority/minor.svg" />
          <span>Minor</span>
        </div>
        <div mat-menu-item class="menu-opts" (click)="selectedMenu('trivial')">
          <img class="images" src="./assets/images/priority/trivial.svg" />
          <span>Trivial</span>
        </div>
      </mat-menu>
    </p>

    <p *ngIf="task.lockStatus && task.lockStatus.isLocked" class="">
      <mat-icon
        class="material-icons-outlined task-icon red"
        matTooltip="Task is locked. Can only be unlocked by user who locked it."
        >lock</mat-icon
      >
    </p>

    <div class="members">
      <span
        class="member"
        *ngFor="let member of task.members"
        matTooltip="{{ member.name }}"
        >{{ member.name | shortname }}</span
      >
    </div>
  </div>
</mat-card>
