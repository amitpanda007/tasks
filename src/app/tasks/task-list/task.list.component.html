<div *ngIf="hasBoardAccess">
  <div class="board-options">
    <div id="left" class="flex-display">
      <div class="board-input" *ngIf="board">
        <div class="flex-display">
          <span
            *ngIf="!editingBoardName"
            class="title option-bg"
            (click)="toggleBoardNameEditing(false)"
            >{{ board.title }}</span
          >
          <span *ngIf="!editingBoardName">
            <svg
              width="18"
              height="18"
              x="0"
              y="0"
              viewBox="0 0 511.98645 511"
              (click)="markBoardFavourite()"
              class="fav-icon"
            >
              <g>
                <path
                  d="m499.574219 188.503906c-3.199219-9.921875-11.988281-16.9375-22.398438-17.898437l-141.355469-12.84375-55.894531-130.835938c-4.117187-9.578125-13.503906-15.765625-23.933593-15.765625-10.433594 0-19.820313 6.207032-23.9375 15.808594l-55.890626 130.816406-141.378906 12.839844c-10.386718.941406-19.175781 7.957031-22.378906 17.878906-3.21875 9.921875-.234375 20.777344 7.617188 27.648438l106.859374 93.695312-31.511718 138.773438c-2.300782 10.199218 1.664062 20.734375 10.136718 26.878906 4.519532 3.328125 9.875 4.992188 15.230469 4.992188 4.628907 0 9.238281-1.234376 13.355469-3.710938l121.898438-72.894531 121.875 72.875c8.917968 5.351562 20.160156 4.882812 28.609374-1.238281 8.46875-6.144532 12.4375-16.683594 10.132813-26.882813l-31.507813-138.769531 106.859376-93.699219c7.847656-6.867187 10.835937-17.726563 7.613281-27.667969zm0 0"
                  [style.fill]="board.favourite ? starred : '#FFF'"
                  data-original="#ffc107"
                ></path>
                <path
                  d="m114.617188 491.136719c-5.632813 0-11.203126-1.746094-15.957032-5.183594-8.855468-6.398437-12.992187-17.429687-10.582031-28.09375l32.9375-145.066406-111.703125-97.964844c-8.210938-7.1875-11.347656-18.515625-7.976562-28.90625 3.371093-10.367187 12.542968-17.726563 23.402343-18.730469l147.820313-13.417968 58.410156-136.746094c4.308594-10.046875 14.121094-16.535156 25.023438-16.535156 10.902343 0 20.714843 6.488281 25.023437 16.511718l58.410156 136.769532 147.796875 13.417968c10.882813.980469 20.054688 8.34375 23.425782 18.710938 3.371093 10.386718.253906 21.738281-7.980469 28.90625l-111.679688 97.941406 32.9375 145.066406c2.414063 10.667969-1.726562 21.695313-10.578125 28.09375-8.8125 6.378906-20.566406 6.914063-29.890625 1.324219l-127.464843-76.160156-127.445313 76.203125c-4.308594 2.582031-9.109375 3.859375-13.929687 3.859375zm141.375-112.871094c4.84375 0 9.640624 1.300781 13.953124 3.859375l120.277344 71.9375-31.085937-136.941406c-2.21875-9.769532 1.089843-19.925782 8.621093-26.515625l105.472657-92.523438-139.542969-12.671875c-10.003906-.894531-18.667969-7.1875-22.59375-16.46875l-55.101562-129.046875-55.148438 129.066407c-3.902344 9.238281-12.5625 15.53125-22.589844 16.429687l-139.519531 12.671875 105.46875 92.519531c7.554687 6.59375 10.839844 16.769531 8.621094 26.539063l-31.082031 136.941406 120.277343-71.9375c4.328125-2.558594 9.128907-3.859375 13.972657-3.859375zm-84.585938-221.824219v.019532zm169.152344-.066406v.023438s0 0 0-.023438zm0 0"
                  fill="#000000"
                  data-original="#000000"
                ></path>
              </g>
            </svg>
          </span>
        </div>
        <div class="boardname-edit-input" *ngIf="editingBoardName">
          <input [(ngModel)]="board.title" class="input" />
          <span (click)="toggleBoardNameEditing(true)" class="done">
            <mat-icon class="icon">done</mat-icon>
          </span>
          <span (click)="toggleBoardNameEditing(false)" class="close">
            <mat-icon class="icon">close</mat-icon>
          </span>
        </div>
      </div>

      <span class="option-dividor"></span>
      <div class="flex-display" #menuUser>
        <div class="members" *ngIf="boardAdmin">
          <span
            class="member"
            matTooltip="{{ boardAdmin.name }}"
            (click)="openMemberMenu(boardAdmin)"
            >{{ boardAdmin.name | shortname
            }}<span class="member-admin admin-img"></span
          ></span>
        </div>

        <div class="members" *ngIf="boardMembers && boardMembers.length > 0">
          <span
            class="member"
            *ngFor="let member of boardMembers"
            matTooltip="{{ member.name }}"
            (click)="openMemberMenu(member)"
            >{{ member.name | shortname }}</span
          >
        </div>

        <mat-icon
          (click)="inviteMembers()"
          aria-label="invite memebers"
          matTooltip="Invite member"
          class="iconBtn"
          >add</mat-icon
        >
      </div>
    </div>
    <div id="right" class="flex-display">
      <div
        class="flex-display option-bg pointer"
        (click)="openAutomation()"
        matTooltip="Feature coming soon"
      >
        <mat-icon class="flex-display icon-small">bolt</mat-icon>
        <span class="txt-small">Automation</span>
      </div>
      <span class="option-dividor"></span>
      <div class="flex-display option-bg pointer" (click)="toggleMenuSidenav()">
        <mat-icon class="flex-display icon-small">more_horiz</mat-icon>
        <span class="txt-small"> Menu</span>
      </div>
    </div>
  </div>

  <div
    class="content-wrapper"
    *ngIf="taskList && tasks && labels"
    cdkDropList
    cdkDropListOrientation="horizontal"
    (cdkDropListDropped)="dropList($event)"
  >
    <div class="container-wrapper">
      <div class="container" *ngFor="let list of taskList" cdkDrag>
        <mat-card class="card">
          <mat-card-header>
            <mat-card-title class="list-header">
              <div class="flex-display">
                <span
                  *ngIf="!list.isEditing"
                  class="pointer"
                  (click)="toggleListNameEditing(false, list)"
                  >{{ list.name }}</span
                >
              </div>
              <div class="list-title" *ngIf="list.isEditing">
                <input [(ngModel)]="list.name" class="list-input" />
                <span (click)="toggleListNameEditing(true, list)" class="done">
                  <mat-icon class="icon pointer">done</mat-icon>
                </span>
                <span
                  (click)="toggleListNameEditing(false, list)"
                  class="close"
                >
                  <mat-icon class="icon pointer">close</mat-icon>
                </span>
              </div>
              <div class="list-options">
                <span
                  [matMenuTriggerFor]="menu"
                  aria-label="sort task under list"
                  class="sort"
                >
                  <mat-icon>sort</mat-icon>
                </span>

                <mat-menu #menu="matMenu">
                  <button
                    mat-menu-item
                    (click)="sortTasks(list.id, sortOrders.INDEX)"
                  >
                    index
                  </button>
                  <button
                    mat-menu-item
                    (click)="sortTasks(list.id, sortOrders.CREATED)"
                  >
                    created
                  </button>
                  <button
                    mat-menu-item
                    (click)="sortTasks(list.id, sortOrders.MODIFIED)"
                  >
                    modified
                  </button>
                  <button
                    mat-menu-item
                    (click)="sortTasks(list.id, sortOrders.DUEDATE)"
                  >
                    duedate
                  </button>
                  <button
                    mat-menu-item
                    (click)="sortTasks(list.id, sortOrders.CHECKLIST)"
                  >
                    checklist
                  </button>
                </mat-menu>

                <span aria-label="drag task list" class="drag" cdkDragHandle>
                  <mat-icon>drag_indicator</mat-icon>
                </span>
              </div>
            </mat-card-title>
          </mat-card-header>
          <!-- <p class="empty-label" *ngIf="emptyContainer">Empty list</p> -->
          <mat-card-content
            cdkDropList
            id="{{ list.id }}"
            [cdkDropListData]="list.tasks"
            [cdkDropListConnectedTo]="remainingList(list.id)"
            (cdkDropListDropped)="drop($event)"
            class="list"
          >
            <p class="empty-label" *ngIf="list.tasks && list.tasks.length == 0">
              Empty list
            </p>
            <div *ngFor="let task of list.tasks">
              <task
                (edit)="editTask($event)"
                cdkDrag
                [task]="task"
                [labels]="labels"
              ></task>
            </div>
          </mat-card-content>
          <div>
            <button
              mat-icon-button
              (click)="createNewTask(list.id)"
              aria-label="drag task list"
              matTooltip="create new task"
            >
              <mat-icon>add</mat-icon>
            </button>
            <button
              mat-icon-button
              (click)="deleteTaskList(list.id)"
              color="warn"
              aria-label="drag task list"
              matTooltip="delete task list"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </mat-card>
      </div>

      <div class="container">
        <mat-card>
          <div *ngIf="!showInputField">
            <button (click)="showInput()" mat-button color="primary">
              <mat-icon>add</mat-icon> Add New List
            </button>
          </div>

          <div *ngIf="showInputField" class="new-list-section">
            <div class="new-list-input">
              <mat-form-field>
                <mat-label>Tasklist title</mat-label>
                <input
                  matInput
                  placeholder="ToDo"
                  autocomplete="off"
                  name="listInput"
                  required
                  [(ngModel)]="listName"
                />
              </mat-form-field>
            </div>

            <div>
              <!-- <button
                (click)="createNewList()"
                mat-icon-button
                color="primary"
                aria-label="create list button"
              >
                <mat-icon>done</mat-icon>
              </button> -->

              <button
                mat-stroked-button
                (click)="createNewList()"
                aria-label="create list button"
              >
                Add
              </button>

              <button
                (click)="hideInput()"
                mat-icon-button
                color="primary"
                aria-label="cancel"
              >
                <mat-icon>close</mat-icon>
              </button>
            </div>
          </div>
        </mat-card>
      </div>
    </div>
  </div>
</div>

<div
  [ngClass]="{ sidenav: !isShowingSidenav, 'sidenav-open': isShowingSidenav }"
>
  <div class="flex-display spacing">
    <p class="menu-header">Menu</p>
    <mat-icon class="icon pointer" (click)="toggleMenuSidenav()"
      >close</mat-icon
    >
  </div>
  <div class="nav-option-dividor"></div>
  <div class="menu-options">
    <div class="menu-option flex-display pointer">
      <mat-icon>read_more</mat-icon>
      <span>About this board</span>
    </div>
    <div class="menu-option flex-display pointer">
      <mat-icon>wallpaper</mat-icon>
      <span>Change background</span>
    </div>
    <div class="menu-option flex-display pointer">
      <mat-icon>search</mat-icon>
      <span>Search cards</span>
    </div>
    <div class="menu-option flex-display pointer">
      <mat-icon>more_horiz</mat-icon>
      <span>more</span>
    </div>
    <div class="nav-option-dividor"></div>
    <div class="flex-display">
      <p>Automation</p>
    </div>
    <div class="nav-option-dividor"></div>
    <div class="flex-display">
      <p>Power-Ups</p>
    </div>
    <div class="nav-option-dividor"></div>
    <div class="flex-display">
      <p>Activity</p>
    </div>
  </div>
</div>
